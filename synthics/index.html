<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width-device-width, initial-scale=1">
	<title>synthics</title>
</head>

<body>
	<header>
	</header>
	<div class="wrap">
		<canvas id="scene" width="300" height="300" style="border-bottom-width: 1px;border-bottom-style: solid;border-left-width: 1px;border-left-style: solid;border-top-width: 1px;border-top-style: solid;border-right-width: 1px;border-right-style: solid;"></canvas>
	</div>

	<script>
		//GLOBAL VARIABLES
		var canvas, ctx, width, height, boxes = [], balls = [], numberBalls, drag, friction, bounce, gravity;
		numberBalls = 2;
		bounce = 0.95;
		gravity = -0.2;
		
		//OBJECTS
		function Ball(i, rad, x, y, vx, vy, color){
			this.rad = rad;
			this.x = x;
			this.y = y;
			this.vx = vx;
			this.vy =vy;
			this.color = color;
			this.i = i;
			
			this.update = function(){
				if(this.x-this.rad <= 0 || this.x+this.rad >= width) this.vx = collide(this.vx);
				if(this.y-this.rad <= 0 || this.y+this.rad >= height) this.vy = collide(this.vy);
				
				for(var i=0; i<numberBalls; i++){ //collision detection w other balls
					if(i != this.i){
						var b = balls[i];
						if(getDistance(this.x, this.y, b.x, b.y) <= this.rad+b.rad)
							{
							console.log(getDistance(this.x, this.y, b.x, b.y));
							this.vx = collide(this.vx);
							//b.vx = collide(b.vx);
							this.vy = collide(this.vy);
							//b.vy = collide(b.vy);
							console.log("bc")}}
				}
				
				this.vy -= gravity; 
				
				//if(this.x-this.rad+15 >= 0 && this.x+this.rad-15 <= width) 
				this.x += this.vx; 
				//if(this.y-this.rad-10 >= 0 && this.y+this.rad+10 <= height)
				this.y += this.vy;
				
				if(this.x-this.rad < 0) this.x = 0 + this.rad;
				if(this.x+this.rad > width) this.x = width - this.rad;
				if(this.y-this.rad < 0) this.y = 0 + this.rad;
				if(this.y+this.rad > height) this.y = height - this.rad;
				
				//console.log("update");

			}
			this.render = function(ctx){
				ctx.beginPath();
				ctx.fillStyle = this.color;
				ctx.arc(this.x, this.y, this.rad, 0, Math.PI * 2);
				ctx.closePath();
				ctx.fill();
				//console.log("render");
			}
		}
		
		//FUNCTIONS
		function clear(){
			ctx.clearRect(0,0,width,height);
		}
		
		function game(){
			clear();
			for(var i=0; i<numberBalls; i++){
				var b = balls[i];
				b.update();
				b.render(ctx);
			}
			
		}
		function collide(v){ //calculates the velocity/spin resulting from a collision
			return -v * bounce;
		}
		function getDistance(x1, y1, x2, y2){
			var xD = x1-x2;
			var yD = y1-y2;
			return Math.sqrt((xD * xD)+(yD * yD));
		}
		//INIT
		document.addEventListener("DOMContentLoaded", function(){
			canvas = document.getElementById("scene");
			ctx = canvas.getContext("2d");
			width = canvas.width;
			height = canvas.height;
			for(var i=0; i<numberBalls; i++){
				var rad = 25;
				var x = Math.round(Math.random() * width);
				var y = Math.round(Math.random() * height);
				var vx = 5; //pixels per tick velocity
				var vy = 3;
				var color = "rgb(200, 0, 30)";
				balls.push(new Ball(i, rad, x, y, vx, vy, color))
			}
			console.log(balls);
			setInterval(game, 10);
		})
	</script>
</body>

</html>
